<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lob Linter</title>
    <style>
      :root {
        --bg-page: #1E2247; /* Indigo-key */
        --bg-card: rgba(255, 255, 255, 0.05); /* Semi-transparent white */
        --text-main: #FFFFFF; /* White */
        --text-muted: #D8D5FF; /* Indigo 30 */
        --accent-primary: #27D0E8; /* Cyan (for active states) */
        --accent-hover: #C4F0F7; /* Cyan 30 */
        --status-success: #41C23E; /* Vivid green */
        --status-error: #F15076: /* Vivid pink */
      }

      body {
        font-family: 'Inter', sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        text-align: center;
        background-color: var(--bg-page);
        color: var(--text-main);
        min-height: 90vh;
      }

      h1 {
        margin-bottom: 0.5rem;
      }

      p {
        color: var(--text-muted);
        margin-bottom: 2rem;
      }

      textarea {
        width: 100%;
        height: 150px;
        background: var(--bg-card);
        border: 2px solid var(--text-muted);
        border-radius: 12px;
        color: var(--text-main);
        padding: 15px;
        font-family: monospace;
        resize: vertical;
        box-sizing: border-box;
      }

      textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
        background: rgba(39, 208, 232, 0.05);
      }

      button {
        margin-top: 15px;
        background: var(--accent-primary);
        color: #000000;
        border: none;
        padding: 12px 30px;
        border-radius: 30px;
        font-weight: bold;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(39, 208, 232, 0.4);
        background: var(--accent-hover);
      }

      #drop-zone {
        display: block;
        border: 3px dashed var(--text-muted);
        border-radius: 20px;
        padding: 60px;
        background-color: var(--bg-card);
        cursor: pointer;
        color: var(--text-main);
      }

      #drop-zone:hover {
        border-color: var(--accent-primary);
        background: rgba(39, 208, 232, 0.1);
        box-shadow: 0 0 15px var(--accent-primary);
      }

      .visually-hidden {
        position: absolute !important;
        height: 1px;
        width: 1px;
        overflow: hidden;
        clip: rect(1px, 1px, 1px, 1px);
        white-space: nowrap;
      }

      #results {
        text-align: left;
        margin-top: 30px;
      }

      .error {
        background: rgba(241, 80, 118, 0.1); /* low opacity pink */
        color: #FFD1DC;
        padding: 15px;
        margin: 8px 0;
        border-left: 5px solid var(--status-error);
        border-radius: 4px;
      }

      .success {
        background: rgba(65, 194, 62, 0.1); /* low opacity green */
        color: #D1FFD0;
        padding: 15px;
        border-left: 5px solid var(--status-success);
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>Lob HTML Linter</h1>
    <p>Drag and drop your HTML file here to check for Lob compatibility.</p>

    <label for="file-input" id="drop-zone"
      >Drop HTML file here<br />(or click to browse)</label
    >
    <input type="file" id="file-input" class="visually-hidden" accept=".html" />

    <textarea id="raw-html-input" placeholder="Or enter your HTML code here... (optional)"></textarea>
    <button id="analyze-button" disabled>Analyze</button>

    <div id="results"></div>

    <script>
      const dropZone = document.getElementById("drop-zone");
      const fileInput = document.getElementById("file-input");
      const resultsDiv = document.getElementById("results");
      const rawHtmlInput = document.getElementById("raw-html-input");
      const analyzeButton = document.getElementById("analyze-button");

      rawHtmlInput.addEventListener("input", (e) => {
        const text = e.target.value;
        analyzeButton.disabled = !text.trim();
      });

      analyzeButton.addEventListener("click", (e) => {
        e.preventDefault();
        const text = rawHtmlInput.value;
        if (!text.trim()) {
          resultsDiv.innerHTML = `<div class="error">Please enter some HTML code.</div>`;
          return;
        } else {
          handleTextUpload(text);
          rawHtmlInput.value = "";
        }
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });

      //drag and drop handling
      ["dragenter", "dragover"].forEach((eventName) => {
        dropZone.addEventListener(eventName, () => {
          dropZone.classList.add("hover");
        });
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(eventName, () => {
          dropZone.classList.remove("hover");
        });
      });

      //handle file drop
      dropZone.addEventListener("drop", (e) => {
        handleFile(e.dataTransfer.files[0]);
      });

      //handle file input change
      fileInput.addEventListener("change", (e) => {
        if (!e.target.files.length) return;
        handleFile(e.target.files[0]);
        fileInput.value = "";
      });

      function handleFile(file) {
        if (!file) return;
        resultsDiv.innerHTML = "Analyzing...";

        const formData = new FormData();
        formData.append("html_file", file);

        fetch("/lint", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then(handleResults)
          .catch((error) => {
            resultsDiv.innerHTML = `<div class="error">Server Error: ${error.message}</div>`;
          });
      }

      function handleTextUpload(text) {
        const formData = new FormData();
        const blob = new Blob([text], { type: "text/html" });
        formData.append("html_file", blob, "raw_text_input.html");
        fetch("/lint", { method: "POST", body: formData })
          .then((response) => response.json())
          .then(handleResults)
          .catch(err => resultsDiv.innerHTML = `<div class="error">Server Error: ${err.message}</div>`);
      }

      function handleResults(data) {
        resultsDiv.innerHTML = ""; // clear loading message

        if (data.errors && data.errors.length > 0) {
          resultsDiv.innerHTML = `<div class="error">⚠️ Found ${data.errors.length} error${data.errors.length > 1 ? "s" : ""}:</div>`;
          data.errors.forEach((error) => {
            const div = document.createElement("div");
            div.className = "error";
            div.textContent = `❌ ${error}`;
            resultsDiv.appendChild(div);
          });
        } else {
          const div = document.createElement("div");
          div.className = "success";
          div.textContent = "✅ No errors found! Your HTML is Lob-ready.";
          resultsDiv.appendChild(div);
        }
      }
    </script>
  </body>
</html>
